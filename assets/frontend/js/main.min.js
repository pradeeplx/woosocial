!function(o,a){var t={cache:function(){t.els={},t.vars={},t.els.$actions_list=o(".jck-woosocial-actions"),t.els.$tab_links=o(".jck-woosocial-tab-link"),t.els.$tab_content=o(".jck-woosocial-tab-content"),t.els.$load_more_button=o(".jck-woosocial-load-more"),t.els.$action_blocks=o(".jck-woosocial-action"),t.els.$likes_container=o(".jck-woosocial-user-likes"),t.vars.action_offset=1,t.vars.is_hidden_class="jck-woosocial--is-hidden"},on_ready:function(){t.cache(),t.setup_follow_actions(),t.setup_like_action(),t.setup_tabs(),t.setup_load_more(),t.setup_activity_log()},on_scroll:function(){t.scroll_activity_log()},setup_follow_actions:function(){o(".jck-woosocial-follow-action").on("click",function(){var a=o(this),s=a.attr("data-user-id"),i=a.attr("data-type"),c="jck-woosocial-follow-action--loading";"login"===i||a.hasClass(c)||(a.addClass(c),o.ajax({type:"GET",url:jck_woosocial_vars.ajax_url,cache:!1,dataType:"jsonp",crossDomain:!0,data:{action:"jck_woosocial_follow_action",nonce:jck_woosocial_vars.nonce,user_id:s,type:i},success:function(s){a.text(s.button.text),a.attr("data-type",s.button.type),a.removeClass(c),a.removeClass("jck-woosocial-follow-action--"+i),a.addClass("jck-woosocial-follow-action--"+s.button.type),s.add_follow_html&&t.els.$actions_list.prepend(s.add_follow_html),s.remove_follow_class&&o(s.remove_follow_class).remove()},error:function(o){}}))})},setup_like_action:function(){o(a).on("click",".jck-woosocial-like-action",function(){var a=o(this),t=a.closest(".jck-woosocial-likes"),s=a.attr("data-product-id"),i=a.attr("data-type"),c=a.find(".jck-woosocial-like-button__count"),e="jck-woosocial-follow-action--loading";return a.hasClass(e)||(a.addClass(e),o.ajax({type:"GET",url:jck_woosocial_vars.ajax_url,cache:!1,dataType:"jsonp",crossDomain:!0,data:{action:"jck_woosocial_like_action",nonce:jck_woosocial_vars.nonce,product_id:s,type:i},success:function(o){if(c.length>0){var s=parseInt(c.text()),n="like"===i?s+1:s-1;c.text(n),a.attr("data-type",o.button.type),a.removeClass(e),a.removeClass("jck-woosocial-like-action--"+i),a.addClass("jck-woosocial-like-action--"+o.button.type),o.add_like_html&&t.find(".jck-woosocial-likes__item--like-button").after(o.add_like_html),o.remove_like_class&&t.find(o.remove_like_class).remove()}},error:function(o){}})),!1})},setup_tabs:function(){t.els.$tab_links.on("click",function(){var a=o(this).attr("href"),s="jck-woosocial-tab-link--active";return t.els.$tab_links.removeClass(s),o(this).addClass(s),t.els.$tab_content.hide(),o(a).show(),!1})},setup_load_more:function(){t.els.$load_more_button.on("click",function(){o(this).hasClass("jck-woosocial-load-more--activity")&&t.load_more_activity(o(this)),o(this).hasClass("jck-woosocial-load-more--likes")&&t.load_more_likes(o(this))})},load_more_activity:function(a){var t=parseInt(a.attr("data-limit")),s=parseInt(a.attr("data-offset")),i=t+s,c=a.attr("data-user-id"),e=a.attr("data-profile-user-id"),n=a.parent();o.ajax({type:"GET",url:jck_woosocial_vars.ajax_url,cache:!1,dataType:"jsonp",crossDomain:!0,data:{action:"jck_woosocial_load_more_activity",nonce:jck_woosocial_vars.nonce,limit:t,offset:s,user_id:c,profile_user_id:e},success:function(o){o.activity_html?(n.before(o.activity_html),a.attr("data-offset",i)):n.remove()},error:function(o){}})},load_more_likes:function(a){var s=parseInt(a.attr("data-limit")),i=parseInt(a.attr("data-offset")),c=s+i,e=a.attr("data-user-id");o.ajax({type:"GET",url:jck_woosocial_vars.ajax_url,cache:!1,dataType:"jsonp",crossDomain:!0,data:{action:"jck_woosocial_load_more_likes",nonce:jck_woosocial_vars.nonce,limit:s,offset:i,user_id:e},success:function(o){o.likes_html?(t.els.$likes_container.append(o.likes_html),a.attr("data-offset",c)):a.remove()},error:function(o){}})},setup_activity_log:function(){t.hide_actions(t.els.$action_blocks,t.vars.action_offset)},hide_actions:function(a,s){a.each(function(){o(this).offset().top>o(window).scrollTop()+o(window).height()*s&&o(this).find(".jck-woosocial-action__icon, .jck-woosocial-action__wrapper").css({opacity:0}).addClass(t.vars.is_hidden_class)})},show_actions:function(a,s){a.each(function(){o(this).offset().top<=o(window).scrollTop()+o(window).height()*s&&o(this).find(".jck-woosocial-action__icon").hasClass(t.vars.is_hidden_class)&&o(this).find(".jck-woosocial-action__icon, .jck-woosocial-action__wrapper").removeClass(t.vars.is_hidden_class).animate({opacity:1})})},scroll_activity_log:function(){window.requestAnimationFrame?window.requestAnimationFrame(function(){t.show_actions(t.els.$action_blocks,t.vars.action_offset)}):setTimeout(function(){t.show_actions(t.els.$action_blocks,t.vars.action_offset)},100)}};o(a).ready(t.on_ready()),o(window).on("scroll",function(){t.on_scroll()})}(jQuery,document);
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIm1haW4uanMiXSwibmFtZXMiOlsiJCIsImRvY3VtZW50IiwiamNrX3dvb3NvY2lhbCIsImNhY2hlIiwiZWxzIiwidmFycyIsIiRhY3Rpb25zX2xpc3QiLCIkdGFiX2xpbmtzIiwiJHRhYl9jb250ZW50IiwiJGxvYWRfbW9yZV9idXR0b24iLCIkYWN0aW9uX2Jsb2NrcyIsIiRsaWtlc19jb250YWluZXIiLCJhY3Rpb25fb2Zmc2V0IiwiaXNfaGlkZGVuX2NsYXNzIiwib25fcmVhZHkiLCJzZXR1cF9mb2xsb3dfYWN0aW9ucyIsInNldHVwX2xpa2VfYWN0aW9uIiwic2V0dXBfdGFicyIsInNldHVwX2xvYWRfbW9yZSIsInNldHVwX2FjdGl2aXR5X2xvZyIsIm9uX3Njcm9sbCIsInNjcm9sbF9hY3Rpdml0eV9sb2ciLCJvbiIsIiRidXR0b24iLCJ0aGlzIiwidXNlcl9pZCIsImF0dHIiLCJ0eXBlIiwibG9hZGluZ19jbGFzcyIsImhhc0NsYXNzIiwiYWRkQ2xhc3MiLCJhamF4IiwidXJsIiwiamNrX3dvb3NvY2lhbF92YXJzIiwiYWpheF91cmwiLCJkYXRhVHlwZSIsImNyb3NzRG9tYWluIiwiZGF0YSIsImFjdGlvbiIsIm5vbmNlIiwic3VjY2VzcyIsInRleHQiLCJidXR0b24iLCJyZW1vdmVDbGFzcyIsImFkZF9mb2xsb3dfaHRtbCIsInByZXBlbmQiLCJyZW1vdmVfZm9sbG93X2NsYXNzIiwicmVtb3ZlIiwiZXJyb3IiLCIkY3VycmVudF9saWtlc19saXN0IiwiY2xvc2VzdCIsInByb2R1Y3RfaWQiLCIkY291bnQiLCJmaW5kIiwibGVuZ3RoIiwiY291bnQiLCJwYXJzZUludCIsIm5ld19jb3VudCIsImFkZF9saWtlX2h0bWwiLCJhZnRlciIsInJlbW92ZV9saWtlX2NsYXNzIiwidGFyZ2V0IiwiYWN0aXZlX2NsYXNzIiwiaGlkZSIsInNob3ciLCJsb2FkX21vcmVfYWN0aXZpdHkiLCJsb2FkX21vcmVfbGlrZXMiLCJsaW1pdCIsIm9mZnNldCIsIm5leHRfb2Zmc2V0IiwicHJvZmlsZV91c2VyX2lkIiwiJGxvYWRfbW9yZV9pdGVtIiwicGFyZW50IiwiYWN0aXZpdHlfaHRtbCIsImJlZm9yZSIsImxpa2VzX2h0bWwiLCJhcHBlbmQiLCJoaWRlX2FjdGlvbnMiLCJlYWNoIiwidG9wIiwid2luZG93Iiwic2Nyb2xsVG9wIiwiaGVpZ2h0IiwiY3NzIiwib3BhY2l0eSIsInNob3dfYWN0aW9ucyIsImFuaW1hdGUiLCJyZXF1ZXN0QW5pbWF0aW9uRnJhbWUiLCJzZXRUaW1lb3V0IiwicmVhZHkiLCJqUXVlcnkiXSwibWFwcGluZ3MiOiJDQUFBLFNBQUFBLEVBQUFDLEdBRUEsR0FBQUMsSUFFQUMsTUFBQSxXQUNBRCxFQUFBRSxPQUNBRixFQUFBRyxRQUVBSCxFQUFBRSxJQUFBRSxjQUFBTixFQUFBLDBCQUNBRSxFQUFBRSxJQUFBRyxXQUFBUCxFQUFBLDJCQUNBRSxFQUFBRSxJQUFBSSxhQUFBUixFQUFBLDhCQUNBRSxFQUFBRSxJQUFBSyxrQkFBQVQsRUFBQSw0QkFDQUUsRUFBQUUsSUFBQU0sZUFBQVYsRUFBQSx5QkFDQUUsRUFBQUUsSUFBQU8saUJBQUFYLEVBQUEsNkJBRUFFLEVBQUFHLEtBQUFPLGNBQUEsRUFDQVYsRUFBQUcsS0FBQVEsZ0JBQUEsNEJBSUFDLFNBQUEsV0FFQVosRUFBQUMsUUFDQUQsRUFBQWEsdUJBQ0FiLEVBQUFjLG9CQUNBZCxFQUFBZSxhQUNBZixFQUFBZ0Isa0JBQ0FoQixFQUFBaUIsc0JBSUFDLFVBQUEsV0FFQWxCLEVBQUFtQix1QkFJQU4scUJBQUEsV0FFQWYsRUFBQSxnQ0FBQXNCLEdBQUEsUUFBQSxXQUVBLEdBQUFDLEdBQUF2QixFQUFBd0IsTUFDQUMsRUFBQUYsRUFBQUcsS0FBQSxnQkFDQUMsRUFBQUosRUFBQUcsS0FBQSxhQUNBRSxFQUFBLHNDQUVBLFdBQUFELEdBSUFKLEVBQUFNLFNBQUFELEtBRUFMLEVBQUFPLFNBQUFGLEdBRUE1QixFQUFBK0IsTUFDQUosS0FBQSxNQUNBSyxJQUFBQyxtQkFBQUMsU0FDQS9CLE9B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QyxZQUFBakYsRUFBQWdGLFFBQUFFLFNBQUF0RSxHQUFBWixFQUFBd0IsTUFBQTZCLEtBQUEsK0JBQUF4QixTQUFBM0IsRUFBQUcsS0FBQVEsa0JBQ0FiLEVBQUF3QixNQUFBNkIsS0FBQSwrREFDQVYsWUFBQXpDLEVBQUFHLEtBQUFRLGlCQUNBeUUsU0FBQUYsUUFBQSxPQU9BL0Qsb0JBQUEsV0FFQTJELE9BQUFPLHNCQU1BUCxPQUFBTyxzQkFBQSxXQUFBckYsRUFBQW1GLGFBQUFuRixFQUFBRSxJQUFBTSxlQUFBUixFQUFBRyxLQUFBTyxpQkFKQTRFLFdBQUEsV0FBQXRGLEVBQUFtRixhQUFBbkYsRUFBQUUsSUFBQU0sZUFBQVIsRUFBQUcsS0FBQU8sZ0JBQUEsTUFZQVosR0FBQUMsR0FBQXdGLE1BQUF2RixFQUFBWSxZQUVBZCxFQUFBZ0YsUUFBQTFELEdBQUEsU0FBQSxXQUNBcEIsRUFBQWtCLGVBR0FzRSxPQUFBekYiLCJmaWxlIjoibWFpbi5taW4uanMiLCJzb3VyY2VzQ29udGVudCI6WyIoZnVuY3Rpb24oJCwgZG9jdW1lbnQpIHtcbiAgICBcbiAgICB2YXIgamNrX3dvb3NvY2lhbCA9IHtcbiAgICAgICAgXG4gICAgICAgIGNhY2hlOiBmdW5jdGlvbigpIHtcbiAgICAgICAgICAgIGpja193b29zb2NpYWwuZWxzID0ge307XG4gICAgICAgICAgICBqY2tfd29vc29jaWFsLnZhcnMgPSB7fTtcbiAgICAgICAgICAgIFxuICAgICAgICAgICAgamNrX3dvb3NvY2lhbC5lbHMuJGFjdGlvbnNfbGlzdCA9ICQoJy5qY2std29vc29jaWFsLWFjdGlvbnMnKTtcbiAgICAgICAgICAgIGpja193b29zb2NpYWwuZWxzLiR0YWJfbGlua3MgPSAkKCcuamNrLXdvb3NvY2lhbC10YWItbGluaycpO1xuICAgICAgICAgICAgamNrX3dvb3NvY2lhbC5lbHMuJHRhYl9jb250ZW50ID0gJCgnLmpjay13b29zb2NpYWwtdGFiLWNvbnRlbnQnKTtcbiAgICAgICAgICAgIGpja193b29zb2NpYWwuZWxzLiRsb2FkX21vcmVfYnV0dG9uID0gJCgnLmpjay13b29zb2NpYWwtbG9hZC1tb3JlJyk7XG4gICAgICAgICAgICBqY2tfd29vc29jaWFsLmVscy4kYWN0aW9uX2Jsb2NrcyA9ICQoJy5qY2std29vc29jaWFsLWFjdGlvbicpOyAgICAgICAgICAgIFxuICAgICAgICAgICAgamNrX3dvb3NvY2lhbC5lbHMuJGxpa2VzX2NvbnRhaW5lciA9ICQoJy5qY2std29vc29jaWFsLXVzZXItbGlrZXMnKTtcbiAgICAgICAgICAgIFxuICAgICAgICAgICAgamNrX3dvb3NvY2lhbC52YXJzLmFjdGlvbl9vZmZzZXQgPSAxO1xuICAgICAgICAgICAgamNrX3dvb3NvY2lhbC52YXJzLmlzX2hpZGRlbl9jbGFzcyA9IFwiamNrLXdvb3NvY2lhbC0taXMtaGlkZGVuXCI7XG4gICAgICAgICAgICBcbiAgICAgICAgfSxcbiBcbiAgICAgICAgb25fcmVhZHk6IGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgXG4gICAgICAgICAgICBqY2tfd29vc29jaWFsLmNhY2hlKCk7XG4gICAgICAgICAgICBqY2tfd29vc29jaWFsLnNldHVwX2ZvbGxvd19hY3Rpb25zKCk7XG4gICAgICAgICAgICBqY2tfd29vc29jaWFsLnNldHVwX2xpa2VfYWN0aW9uKCk7XG4gICAgICAgICAgICBqY2tfd29vc29jaWFsLnNldHVwX3RhYnMoKTtcbiAgICAgICAgICAgIGpja193b29zb2NpYWwuc2V0dXBfbG9hZF9tb3JlKCk7XG4gICAgICAgICAgICBqY2tfd29vc29jaWFsLnNldHVwX2FjdGl2aXR5X2xvZygpO1xuICAgICAgICAgICAgXG4gICAgICAgIH0sXG4gICAgICAgIFxuICAgICAgICBvbl9zY3JvbGw6IGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgXG4gICAgICAgICAgICBqY2tfd29vc29jaWFsLnNjcm9sbF9hY3Rpdml0eV9sb2coKTtcbiAgICAgICAgICAgIFxuICAgICAgICB9LFxuICAgICBcbiAgICAgICAgc2V0dXBfZm9sbG93X2FjdGlvbnM6IGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgXG4gICAgICAgICAgICAkKCcuamNrLXdvb3NvY2lhbC1mb2xsb3ctYWN0aW9uJykub24oJ2NsaWNrJywgZnVuY3Rpb24oKXtcbiAgICAgICAgICAgICAgICBcbiAgICAgICAgICAgICAgICB2YXIgJGJ1dHRvbiA9ICQodGhpcyksXG4gICAgICAgICAgICAgICAgICAgIHVzZXJfaWQgPSAkYnV0dG9uLmF0dHIoJ2RhdGEtdXNlci1pZCcpLFxuICAgICAgICAgICAgICAgICAgICB0eXBlID0gJGJ1dHRvbi5hdHRyKCdkYXRhLXR5cGUnKSxcbiAgICAgICAgICAgICAgICAgICAgbG9hZGluZ19jbGFzcyA9ICdqY2std29vc29jaWFsLWZvbGxvdy1hY3Rpb24tLWxvYWRpbmcnO1xuICAgICAgICAgICAgICAgIFxuICAgICAgICAgICAgICAgIGlmKCB0eXBlID09PSBcImxvZ2luXCIgKSB7XG4gICAgICAgICAgICAgICAgICAgIFxuICAgICAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgXG4gICAgICAgICAgICAgICAgICAgIGlmKCAhJGJ1dHRvbi5oYXNDbGFzcyhsb2FkaW5nX2NsYXNzKSApIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIFxuICAgICAgICAgICAgICAgICAgICAgICAgJGJ1dHRvbi5hZGRDbGFzcyhsb2FkaW5nX2NsYXNzKTtcbiAgICAgICAgICAgICAgICAgICAgXG4gICAgICAgICAgICAgICAgICAgICAgICAkLmFqYXgoe1xuICAgICAgICAgICAgXHRcdFx0XHR0eXBlOiAgICAgICAgXCJHRVRcIixcbiAgICAgICAgICAgIFx0XHRcdFx0dXJsOiAgICAgICAgIGpja193b29zb2NpYWxfdmFycy5hamF4X3VybCxcbiAgICAgICAgICAgIFx0XHRcdFx0Y2FjaGU6ICAgICAgIGZhbHNlLFxuICAgICAgICAgICAgXHRcdFx0XHRkYXRhVHlwZTogICAgXCJqc29ucFwiLFx0XHRcdFx0XG4gICAgICAgICAgICBcdFx0XHRcdGNyb3NzRG9tYWluOiB0cnVlLFxuICAgICAgICAgICAgXHRcdFx0XHRkYXRhOiB7XG4gICAgICAgICAgICBcdFx0XHRcdFx0YWN0aW9uOiAgJ2pja193b29zb2NpYWxfZm9sbG93X2FjdGlvbicsXG4gICAgICAgICAgICBcdFx0XHRcdFx0bm9uY2U6ICAgamNrX3dvb3NvY2lhbF92YXJzLm5vbmNlLFxuICAgICAgICAgICAgXHRcdFx0XHRcdHVzZXJfaWQ6IHVzZXJfaWQsXG4gICAgICAgICAgICBcdFx0XHRcdFx0dHlwZTogICAgdHlwZVxuICAgICAgICAgICAgXHRcdFx0XHR9LFxuICAgICAgICAgICAgXHRcdFx0XHRcbiAgICAgICAgICAgIFx0XHRcdFx0c3VjY2VzczogZnVuY3Rpb24oIGRhdGEgKSB7XG4gICAgICAgICAgICBcdFx0XHRcdFx0XG4gICAgICAgICAgICBcdFx0XHRcdFx0JGJ1dHRvbi50ZXh0KGRhdGEuYnV0dG9uLnRleHQpO1xuICAgICAgICAgICAgXHRcdFx0XHRcdCRidXR0b24uYXR0cignZGF0YS10eXBlJyxkYXRhLmJ1dHRvbi50eXBlKTtcbiAgICAgICAgICAgIFx0XHRcdFx0XHRcbiAgICAgICAgICAgIFx0XHRcdFx0XHQkYnV0dG9uLnJlbW92ZUNsYXNzKGxvYWRpbmdfY2xhc3MpO1xuICAgICAgICAgICAgXHRcdFx0XHRcdCRidXR0b24ucmVtb3ZlQ2xhc3MoJ2pjay13b29zb2NpYWwtZm9sbG93LWFjdGlvbi0tJyt0eXBlKTtcbiAgICAgICAgICAgIFx0XHRcdFx0XHQkYnV0dG9uLmFkZENsYXNzKCdqY2std29vc29jaWFsLWZvbGxvdy1hY3Rpb24tLScrZGF0YS5idXR0b24udHlwZSk7XG4gICAgICAgICAgICBcdFx0XHRcdFx0XG4gICAgICAgICAgICBcdFx0XHRcdFx0aWYoZGF0YS5hZGRfZm9sbG93X2h0bWwpIHtcbiAgICAgICAgICAgICAgICBcdFx0XHRcdFx0amNrX3dvb3NvY2lhbC5lbHMuJGFjdGlvbnNfbGlzdC5wcmVwZW5kKGRhdGEuYWRkX2ZvbGxvd19odG1sKTtcbiAgICAgICAgICAgIFx0XHRcdFx0XHR9XG4gICAgICAgICAgICBcdFx0XHRcdFx0XG4gICAgICAgICAgICBcdFx0XHRcdFx0aWYoZGF0YS5yZW1vdmVfZm9sbG93X2NsYXNzKSB7XG4gICAgICAgICAgICAgICAgXHRcdFx0XHRcdCQoZGF0YS5yZW1vdmVfZm9sbG93X2NsYXNzKS5yZW1vdmUoKTtcbiAgICAgICAgICAgIFx0XHRcdFx0XHR9XG4gICAgICAgICAgICBcdFx0XHRcdH0sXG4gICAgICAgICAgICBcdFx0XHRcdFxuICAgICAgICAgICAgXHRcdFx0XHRlcnJvcjogZnVuY3Rpb24oIGRhdGEgKSB7XG4gICAgICAgICAgICAgICAgXHRcdFx0XHRcbiAgICAgICAgICAgIFx0XHRcdFx0fVxuICAgICAgICAgICAgXHRcdFx0fSk7XG4gICAgICAgIFx0XHRcdFxuICAgICAgICBcdFx0XHR9XG4gICAgXHRcdFx0XG4gICAgXHRcdFx0fVxuXHRcdFx0XG5cdFx0XHR9KTtcbiAgICAgICAgICAgIFxuICAgICAgICB9LFxuICAgICAgICBcbiAgICAgICAgc2V0dXBfbGlrZV9hY3Rpb246IGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgXG4gICAgICAgICAgICAkKGRvY3VtZW50KS5vbignY2xpY2snLCAnLmpjay13b29zb2NpYWwtbGlrZS1hY3Rpb24nLCBmdW5jdGlvbigpe1xuICAgICAgICAgICAgICAgIFxuICAgICAgICAgICAgICAgIHZhciAkYnV0dG9uID0gJCh0aGlzKSxcbiAgICAgICAgICAgICAgICAgICAgJGN1cnJlbnRfbGlrZXNfbGlzdCA9ICRidXR0b24uY2xvc2VzdCgnLmpjay13b29zb2NpYWwtbGlrZXMnKSxcbiAgICAgICAgICAgICAgICAgICAgcHJvZHVjdF9pZCA9ICRidXR0b24uYXR0cignZGF0YS1wcm9kdWN0LWlkJyksXG4gICAgICAgICAgICAgICAgICAgIHR5cGUgPSAkYnV0dG9uLmF0dHIoJ2RhdGEtdHlwZScpLFxuICAgICAgICAgICAgICAgICAgICAkY291bnQgPSAkYnV0dG9uLmZpbmQoJy5qY2std29vc29jaWFsLWxpa2UtYnV0dG9uX19jb3VudCcpLFxuICAgICAgICAgICAgICAgICAgICBsb2FkaW5nX2NsYXNzID0gJ2pjay13b29zb2NpYWwtZm9sbG93LWFjdGlvbi0tbG9hZGluZyc7XG4gICAgICAgICAgICAgICAgICAgIFxuICAgICAgICAgICAgICAgIGlmKCAhJGJ1dHRvbi5oYXNDbGFzcyhsb2FkaW5nX2NsYXNzKSApIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIFxuICAgICAgICAgICAgICAgICAgICAkYnV0dG9uLmFkZENsYXNzKGxvYWRpbmdfY2xhc3MpO1xuICAgICAgICAgICAgICAgICAgICBcbiAgICAgICAgICAgICAgICAgICAgJC5hamF4KHtcbiAgICAgICAgXHRcdFx0XHR0eXBlOiBcIkdFVFwiLFxuICAgICAgICBcdFx0XHRcdHVybDogamNrX3dvb3NvY2lhbF92YXJzLmFqYXhfdXJsLFxuICAgICAgICBcdFx0XHRcdGNhY2hlOiBmYWxzZSxcbiAgICAgICAgXHRcdFx0XHRkYXRhVHlwZTogXCJqc29ucFwiLFx0XHRcdFx0XG4gICAgICAgIFx0XHRcdFx0Y3Jvc3NEb21haW46IHRydWUsXG4gICAgICAgIFx0XHRcdFx0ZGF0YToge1xuICAgICAgICBcdFx0XHRcdFx0YWN0aW9uOiAnamNrX3dvb3NvY2lhbF9saWtlX2FjdGlvbicsXG4gICAgICAgIFx0XHRcdFx0XHRub25jZTogamNrX3dvb3NvY2lhbF92YXJzLm5vbmNlLFxuICAgICAgICBcdFx0XHRcdFx0cHJvZHVjdF9pZDogcHJvZHVjdF9pZCxcbiAgICAgICAgXHRcdFx0XHRcdHR5cGU6IHR5cGVcbiAgICAgICAgXHRcdFx0XHR9LFxuICAgICAgICBcdFx0XHRcdFxuICAgICAgICBcdFx0XHRcdHN1Y2Nlc3M6IGZ1bmN0aW9uKCBkYXRhICkge1xuICAgICAgICBcdFx0XHRcdFx0XG4gICAgICAgIFx0XHRcdFx0XHRpZiggJGNvdW50Lmxlbmd0aCA+IDAgKSB7XG4gICAgICAgICAgICBcdFx0XHRcdFx0XG4gICAgICAgICAgICBcdFx0XHRcdFx0dmFyIGNvdW50ID0gcGFyc2VJbnQoJGNvdW50LnRleHQoKSksXG4gICAgICAgICAgICBcdFx0XHRcdFx0ICAgIG5ld19jb3VudCA9IHR5cGUgPT09IFwibGlrZVwiID8gY291bnQrMSA6IGNvdW50LTE7XG4gICAgICAgICAgICBcdFx0XHRcdFx0XG4gICAgICAgICAgICBcdFx0XHRcdFx0JGNvdW50LnRleHQoIG5ld19jb3VudCApOyBcbiAgICAgICAgICAgIFx0XHRcdFx0XHQkYnV0dG9uLmF0dHIoJ2RhdGEtdHlwZScsIGRhdGEuYnV0dG9uLnR5cGUpO1xuICAgICAgICAgICAgXHRcdFx0XHRcdFxuICAgICAgICAgICAgXHRcdFx0XHRcdCRidXR0b24ucmVtb3ZlQ2xhc3MobG9hZGluZ19jbGFzcyk7XG4gICAgICAgICAgICBcdFx0XHRcdFx0JGJ1dHRvbi5yZW1vdmVDbGFzcygnamNrLXdvb3NvY2lhbC1saWtlLWFjdGlvbi0tJyt0eXBlKTtcbiAgICAgICAgICAgIFx0XHRcdFx0XHQkYnV0dG9uLmFkZENsYXNzKCdqY2std29vc29jaWFsLWxpa2UtYWN0aW9uLS0nK2RhdGEuYnV0dG9uLnR5cGUpO1xuICAgICAgICAgICAgXHRcdFx0XHRcdFxuICAgICAgICAgICAgXHRcdFx0XHRcdGlmKGRhdGEuYWRkX2xpa2VfaHRtbCkge1xuICAgICAgICAgICAgICAgIFx0XHRcdFx0XHQkY3VycmVudF9saWtlc19saXN0LmZpbmQoJy5qY2std29vc29jaWFsLWxpa2VzX19pdGVtLS1saWtlLWJ1dHRvbicpLmFmdGVyKGRhdGEuYWRkX2xpa2VfaHRtbCk7XG4gICAgICAgICAgICBcdFx0XHRcdFx0fVxuICAgICAgICAgICAgXHRcdFx0XHRcdFxuICAgICAgICAgICAgXHRcdFx0XHRcdGlmKGRhdGEucmVtb3ZlX2xpa2VfY2xhc3MpIHtcbiAgICAgICAgICAgICAgICBcdFx0XHRcdFx0JGN1cnJlbnRfbGlrZXNfbGlzdC5maW5kKGRhdGEucmVtb3ZlX2xpa2VfY2xhc3MpLnJlbW92ZSgpO1xuICAgICAgICAgICAgXHRcdFx0XHRcdH0gICAgIFx0XHRcdFx0XHRcbiAgICAgICAgICAgIFx0XHRcdFx0XHRcbiAgICAgICAgXHRcdFx0XHRcdH1cbiAgICAgICAgXHRcdFx0XHR9LFxuICAgICAgICBcdFx0XHRcdFxuICAgICAgICBcdFx0XHRcdGVycm9yOiBmdW5jdGlvbiggZGF0YSApIHtcbiAgICAgICAgICAgIFx0XHRcdFx0XG4gICAgICAgIFx0XHRcdFx0fVxuICAgICAgICBcdFx0XHR9KTtcbiAgICAgICAgXG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIFxuICAgICAgICAgICAgICAgIHJldHVybiBmYWxzZTtcbiAgICAgICAgICAgICAgICBcbiAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgXG4gICAgICAgIH0sXG4gICAgICAgIFxuICAgICAgICBzZXR1cF90YWJzOiBmdW5jdGlvbigpIHtcbiAgICAgICAgICAgIFxuICAgICAgICAgICAgamNrX3dvb3NvY2lhbC5lbHMuJHRhYl9saW5rcy5vbignY2xpY2snLCBmdW5jdGlvbigpe1xuICAgICAgICAgICAgICAgIFxuICAgICAgICAgICAgICAgIHZhciB0YXJnZXQgPSAkKHRoaXMpLmF0dHIoJ2hyZWYnKSxcbiAgICAgICAgICAgICAgICAgICAgYWN0aXZlX2NsYXNzID0gJ2pjay13b29zb2NpYWwtdGFiLWxpbmstLWFjdGl2ZSc7XG4gICAgICAgICAgICAgICAgXG4gICAgICAgICAgICAgICAgamNrX3dvb3NvY2lhbC5lbHMuJHRhYl9saW5rcy5yZW1vdmVDbGFzcyhhY3RpdmVfY2xhc3MpO1xuICAgICAgICAgICAgICAgICQodGhpcykuYWRkQ2xhc3MoYWN0aXZlX2NsYXNzKTtcbiAgICAgICAgICAgICAgICBqY2tfd29vc29jaWFsLmVscy4kdGFiX2NvbnRlbnQuaGlkZSgpO1xuICAgICAgICAgICAgICAgICQodGFyZ2V0KS5zaG93KCk7XG4gICAgICAgICAgICAgICAgXG4gICAgICAgICAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgICAgICAgICAgICAgIFxuICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICBcbiAgICAgICAgfSxcbiAgICAgICAgXG4gICAgICAgIHNldHVwX2xvYWRfbW9yZTogZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICBcbiAgICAgICAgICAgIGpja193b29zb2NpYWwuZWxzLiRsb2FkX21vcmVfYnV0dG9uLm9uKCdjbGljaycsIGZ1bmN0aW9uKCl7XG4gICAgICAgICAgICAgICBcbiAgICAgICAgICAgICAgICBpZiggJCh0aGlzKS5oYXNDbGFzcygnamNrLXdvb3NvY2lhbC1sb2FkLW1vcmUtLWFjdGl2aXR5JykgKSB7XG4gICAgICAgICAgICAgICAgICAgIGpja193b29zb2NpYWwubG9hZF9tb3JlX2FjdGl2aXR5KCAkKHRoaXMpICk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICBcbiAgICAgICAgICAgICAgICBpZiggJCh0aGlzKS5oYXNDbGFzcygnamNrLXdvb3NvY2lhbC1sb2FkLW1vcmUtLWxpa2VzJykgKSB7XG4gICAgICAgICAgICAgICAgICAgIGpja193b29zb2NpYWwubG9hZF9tb3JlX2xpa2VzKCAkKHRoaXMpICk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIFxuICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICBcbiAgICAgICAgfSxcbiAgICAgICAgXG4gICAgICAgIGxvYWRfbW9yZV9hY3Rpdml0eTogZnVuY3Rpb24oICRsb2FkX21vcmVfYnV0dG9uICkge1xuICAgICAgICAgICAgXG4gICAgICAgICAgICB2YXIgbGltaXQgPSBwYXJzZUludCggJGxvYWRfbW9yZV9idXR0b24uYXR0cignZGF0YS1saW1pdCcpICksXG4gICAgICAgICAgICAgICAgb2Zmc2V0ID0gcGFyc2VJbnQoICRsb2FkX21vcmVfYnV0dG9uLmF0dHIoJ2RhdGEtb2Zmc2V0JykgKSxcbiAgICAgICAgICAgICAgICBuZXh0X29mZnNldCA9IGxpbWl0K29mZnNldCxcbiAgICAgICAgICAgICAgICB1c2VyX2lkID0gJGxvYWRfbW9yZV9idXR0b24uYXR0cignZGF0YS11c2VyLWlkJyksXG4gICAgICAgICAgICAgICAgcHJvZmlsZV91c2VyX2lkID0gJGxvYWRfbW9yZV9idXR0b24uYXR0cignZGF0YS1wcm9maWxlLXVzZXItaWQnKSxcbiAgICAgICAgICAgICAgICAkbG9hZF9tb3JlX2l0ZW0gPSAkbG9hZF9tb3JlX2J1dHRvbi5wYXJlbnQoKTtcbiAgICAgICAgICAgICAgICBcbiAgICAgICAgICAgICQuYWpheCh7XG5cdFx0XHRcdHR5cGU6ICAgICAgICBcIkdFVFwiLFxuXHRcdFx0XHR1cmw6ICAgICAgICAgamNrX3dvb3NvY2lhbF92YXJzLmFqYXhfdXJsLFxuXHRcdFx0XHRjYWNoZTogICAgICAgZmFsc2UsXG5cdFx0XHRcdGRhdGFUeXBlOiAgICBcImpzb25wXCIsXHRcdFx0XHRcblx0XHRcdFx0Y3Jvc3NEb21haW46IHRydWUsXG5cdFx0XHRcdGRhdGE6IHtcblx0XHRcdFx0XHRhY3Rpb246ICAgICAgICAgICdqY2tfd29vc29jaWFsX2xvYWRfbW9yZV9hY3Rpdml0eScsXG5cdFx0XHRcdFx0bm9uY2U6ICAgICAgICAgICBqY2tfd29vc29jaWFsX3ZhcnMubm9uY2UsXG5cdFx0XHRcdFx0bGltaXQ6ICAgICAgICAgICBsaW1pdCxcblx0XHRcdFx0XHRvZmZzZXQ6ICAgICAgICAgIG9mZnNldCxcblx0XHRcdFx0XHR1c2VyX2lkOiAgICAgICAgIHVzZXJfaWQsXG5cdFx0XHRcdFx0cHJvZmlsZV91c2VyX2lkOiBwcm9maWxlX3VzZXJfaWRcblx0XHRcdFx0fSxcblx0XHRcdFx0XG5cdFx0XHRcdHN1Y2Nlc3M6IGZ1bmN0aW9uKCBkYXRhICkge1xuXHRcdFx0XHRcdFxuXHRcdFx0XHRcdGlmKCBkYXRhLmFjdGl2aXR5X2h0bWwgKSB7XG4gICAgXHRcdFx0XHRcdFxuICAgIFx0XHRcdFx0XHQkbG9hZF9tb3JlX2l0ZW0uYmVmb3JlKCBkYXRhLmFjdGl2aXR5X2h0bWwgKTtcbiAgICBcdFx0XHRcdFx0JGxvYWRfbW9yZV9idXR0b24uYXR0cignZGF0YS1vZmZzZXQnLCBuZXh0X29mZnNldCkgO1xuICAgIFx0XHRcdFx0XHRcblx0XHRcdFx0XHR9IGVsc2Uge1xuICAgIFx0XHRcdFx0XHRcbiAgICBcdFx0XHRcdFx0JGxvYWRfbW9yZV9pdGVtLnJlbW92ZSgpO1xuICAgIFx0XHRcdFx0XHRcblx0XHRcdFx0XHR9XG5cdFx0XHRcdFx0XG5cdFx0XHRcdH0sXG5cdFx0XHRcdFxuXHRcdFx0XHRlcnJvcjogZnVuY3Rpb24oIGRhdGEgKSB7XG4gICAgXHRcdFx0XHRcblx0XHRcdFx0fVxuXHRcdFx0fSk7XG4gICAgICAgICAgICBcbiAgICAgICAgfSxcbiAgICAgICAgXG4gICAgICAgIGxvYWRfbW9yZV9saWtlczogZnVuY3Rpb24oICRsb2FkX21vcmVfYnV0dG9uICkge1xuICAgICAgICAgICAgXG4gICAgICAgICAgICB2YXIgbGltaXQgPSBwYXJzZUludCggJGxvYWRfbW9yZV9idXR0b24uYXR0cignZGF0YS1saW1pdCcpICksXG4gICAgICAgICAgICAgICAgb2Zmc2V0ID0gcGFyc2VJbnQoICRsb2FkX21vcmVfYnV0dG9uLmF0dHIoJ2RhdGEtb2Zmc2V0JykgKSxcbiAgICAgICAgICAgICAgICBuZXh0X29mZnNldCA9IGxpbWl0K29mZnNldCxcbiAgICAgICAgICAgICAgICB1c2VyX2lkID0gJGxvYWRfbW9yZV9idXR0b24uYXR0cignZGF0YS11c2VyLWlkJyk7XG4gICAgICAgICAgICAgICAgXG4gICAgICAgICAgICAkLmFqYXgoe1xuXHRcdFx0XHR0eXBlOiAgICAgICAgXCJHRVRcIixcblx0XHRcdFx0dXJsOiAgICAgICAgIGpja193b29zb2NpYWxfdmFycy5hamF4X3VybCxcblx0XHRcdFx0Y2FjaGU6ICAgICAgIGZhbHNlLFxuXHRcdFx0XHRkYXRhVHlwZTogICAgXCJqc29ucFwiLFx0XHRcdFx0XG5cdFx0XHRcdGNyb3NzRG9tYWluOiB0cnVlLFxuXHRcdFx0XHRkYXRhOiB7XG5cdFx0XHRcdFx0YWN0aW9uOiAgJ2pja193b29zb2NpYWxfbG9hZF9tb3JlX2xpa2VzJyxcblx0XHRcdFx0XHRub25jZTogICBqY2tfd29vc29jaWFsX3ZhcnMubm9uY2UsXG5cdFx0XHRcdFx0bGltaXQ6ICAgbGltaXQsXG5cdFx0XHRcdFx0b2Zmc2V0OiAgb2Zmc2V0LFxuXHRcdFx0XHRcdHVzZXJfaWQ6IHVzZXJfaWRcblx0XHRcdFx0fSxcblx0XHRcdFx0XG5cdFx0XHRcdHN1Y2Nlc3M6IGZ1bmN0aW9uKCBkYXRhICkge1xuXHRcdFx0XHRcdFxuXHRcdFx0XHRcdGlmKCBkYXRhLmxpa2VzX2h0bWwgKSB7XG4gICAgXHRcdFx0XHRcdFxuICAgIFx0XHRcdFx0XHRqY2tfd29vc29jaWFsLmVscy4kbGlrZXNfY29udGFpbmVyLmFwcGVuZCggZGF0YS5saWtlc19odG1sICk7XG4gICAgXHRcdFx0XHRcdCRsb2FkX21vcmVfYnV0dG9uLmF0dHIoJ2RhdGEtb2Zmc2V0JywgbmV4dF9vZmZzZXQpIDtcbiAgICBcdFx0XHRcdFx0XG5cdFx0XHRcdFx0fSBlbHNlIHtcbiAgICBcdFx0XHRcdFx0XG4gICAgXHRcdFx0XHRcdCRsb2FkX21vcmVfYnV0dG9uLnJlbW92ZSgpO1xuICAgIFx0XHRcdFx0XHRcblx0XHRcdFx0XHR9XG5cdFx0XHRcdFx0XG5cdFx0XHRcdH0sXG5cdFx0XHRcdFxuXHRcdFx0XHRlcnJvcjogZnVuY3Rpb24oIGRhdGEgKSB7XG4gICAgXHRcdFx0XHRcblx0XHRcdFx0fVxuXHRcdFx0fSk7XG4gICAgICAgICAgICBcbiAgICAgICAgfSxcbiAgICAgICAgXG4gICAgICAgIHNldHVwX2FjdGl2aXR5X2xvZzogZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICBcbiAgICAgICAgICAgIGpja193b29zb2NpYWwuaGlkZV9hY3Rpb25zKGpja193b29zb2NpYWwuZWxzLiRhY3Rpb25fYmxvY2tzLCBqY2tfd29vc29jaWFsLnZhcnMuYWN0aW9uX29mZnNldCk7XG4gICAgICAgICAgICBcbiAgICAgICAgfSxcbiAgICAgICAgXG4gICAgICAgIGhpZGVfYWN0aW9uczogZnVuY3Rpb24oJGFjdGlvbl9ibG9ja3MsIGFjdGlvbl9vZmZzZXQpIHtcbiAgICBcdFx0XG4gICAgXHRcdCRhY3Rpb25fYmxvY2tzLmVhY2goZnVuY3Rpb24oKXtcbiAgICBcdFx0XHRcbiAgICBcdFx0XHRpZiggJCh0aGlzKS5vZmZzZXQoKS50b3AgPiAkKHdpbmRvdykuc2Nyb2xsVG9wKCkrJCh3aW5kb3cpLmhlaWdodCgpKmFjdGlvbl9vZmZzZXQgKSB7XG4gICAgICAgIFx0XHRcdCQodGhpcykuZmluZCgnLmpjay13b29zb2NpYWwtYWN0aW9uX19pY29uLCAuamNrLXdvb3NvY2lhbC1hY3Rpb25fX3dyYXBwZXInKS5jc3MoeyBvcGFjaXR5OiAwIH0pLmFkZENsYXNzKGpja193b29zb2NpYWwudmFycy5pc19oaWRkZW5fY2xhc3MpO1xuICAgICAgICAgICAgICAgIH1cbiAgICBcdFx0XHRcbiAgICBcdFx0fSk7XG4gICAgXHRcdFxuICAgIFx0fSxcbiAgICBcbiAgICBcdHNob3dfYWN0aW9uczogZnVuY3Rpb24oJGFjdGlvbl9ibG9ja3MsIGFjdGlvbl9vZmZzZXQpIHtcbiAgICBcdFx0XG4gICAgXHRcdCRhY3Rpb25fYmxvY2tzLmVhY2goZnVuY3Rpb24oKXtcbiAgICBcdFx0XHRcbiAgICBcdFx0XHRpZiggJCh0aGlzKS5vZmZzZXQoKS50b3AgPD0gJCh3aW5kb3cpLnNjcm9sbFRvcCgpKyQod2luZG93KS5oZWlnaHQoKSphY3Rpb25fb2Zmc2V0ICYmICQodGhpcykuZmluZCgnLmpjay13b29zb2NpYWwtYWN0aW9uX19pY29uJykuaGFzQ2xhc3MoamNrX3dvb3NvY2lhbC52YXJzLmlzX2hpZGRlbl9jbGFzcykgKSB7XG4gICAgICAgIFx0XHRcdCQodGhpcykuZmluZCgnLmpjay13b29zb2NpYWwtYWN0aW9uX19pY29uLCAuamNrLXdvb3NvY2lhbC1hY3Rpb25fX3dyYXBwZXInKVxuICAgICAgICBcdFx0XHQgICAgLnJlbW92ZUNsYXNzKGpja193b29zb2NpYWwudmFycy5pc19oaWRkZW5fY2xhc3MpXG4gICAgICAgIFx0XHRcdCAgICAuYW5pbWF0ZSh7IG9wYWNpdHk6IDEgfSk7XG4gICAgICAgICAgICAgICAgfVxuICAgIFx0XHRcdFxuICAgIFx0XHR9KTtcbiAgICBcdFx0XG4gICAgXHR9LFxuICAgIFx0XG4gICAgXHRzY3JvbGxfYWN0aXZpdHlfbG9nOiBmdW5jdGlvbigpIHtcbiAgICAgICAgXHRcbiAgICAgICAgXHRpZighd2luZG93LnJlcXVlc3RBbmltYXRpb25GcmFtZSkge1xuICAgICAgICAgICAgXHRcblx0XHRcdCAgICBzZXRUaW1lb3V0KGZ1bmN0aW9uKCl7IGpja193b29zb2NpYWwuc2hvd19hY3Rpb25zKGpja193b29zb2NpYWwuZWxzLiRhY3Rpb25fYmxvY2tzLCBqY2tfd29vc29jaWFsLnZhcnMuYWN0aW9uX29mZnNldCk7IH0sIDEwMCk7XG4gICAgICAgICAgIFxuICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICBcbiAgICAgICAgICAgICAgICB3aW5kb3cucmVxdWVzdEFuaW1hdGlvbkZyYW1lKGZ1bmN0aW9uKCl7IGpja193b29zb2NpYWwuc2hvd19hY3Rpb25zKGpja193b29zb2NpYWwuZWxzLiRhY3Rpb25fYmxvY2tzLCBqY2tfd29vc29jaWFsLnZhcnMuYWN0aW9uX29mZnNldCk7IH0pOyAgXG4gICAgICAgICAgICAgICAgXG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBcbiAgICBcdH1cbiAgICAgXG4gICAgfTtcbiAgICBcblx0JChkb2N1bWVudCkucmVhZHkoIGpja193b29zb2NpYWwub25fcmVhZHkoKSApO1xuXHRcblx0JCh3aW5kb3cpLm9uKCdzY3JvbGwnLCBmdW5jdGlvbigpe1xuICAgIFx0amNrX3dvb3NvY2lhbC5vbl9zY3JvbGwoKTtcbiAgICB9KTtcblxufShqUXVlcnksIGRvY3VtZW50KSk7Il0sInNvdXJjZVJvb3QiOiIvc291cmNlLyJ9