!function(o,a){var t={cache:function(){t.els={},t.vars={},t.els.$actions_list=o(".jck_woo_social-actions"),t.els.$tab_links=o(".jck_woo_social-tab-link"),t.els.$tab_content=o(".jck_woo_social-tab-content"),t.els.$load_more_button=o(".jck_woo_social-load-more"),t.els.$action_blocks=o(".jck_woo_social-action"),t.els.$likes_container=o(".jck_woo_social-likes"),t.vars.action_offset=1,t.vars.is_hidden_class="jck_woo_social--is-hidden"},on_ready:function(){t.cache(),t.setup_follow_actions(),t.setup_like_action(),t.setup_tabs(),t.setup_load_more(),t.setup_activity_log()},on_scroll:function(){t.scroll_activity_log()},setup_follow_actions:function(){o(".jck_woo_social-follow-action").on("click",function(){var a=o(this),s=a.attr("data-user-id"),i=a.attr("data-type"),c="jck_woo_social-follow-action--loading";"login"===i||a.hasClass(c)||(a.addClass(c),o.ajax({type:"GET",url:jck_woo_social_vars.ajax_url,cache:!1,dataType:"jsonp",crossDomain:!0,data:{action:"jck_woo_social_follow_action",nonce:jck_woo_social_vars.nonce,user_id:s,type:i},success:function(s){a.text(s.button.text),a.attr("data-type",s.button.type),a.removeClass(c),a.removeClass("jck_woo_social-follow-action--"+i),a.addClass("jck_woo_social-follow-action--"+s.button.type),s.add_follow_html&&t.els.$actions_list.prepend(s.add_follow_html),s.remove_follow_class&&o(s.remove_follow_class).remove()},error:function(o){}}))})},setup_like_action:function(){o(a).on("click",".jck-woo-social-like-action",function(){var a=o(this),t=a.closest(".jck-woo-social-likes"),s=a.attr("data-product-id"),i=a.attr("data-type"),c=a.find(".jck-woo-social-like-button__count"),e="jck_woo_social-follow-action--loading";return a.hasClass(e)||(a.addClass(e),o.ajax({type:"GET",url:jck_woo_social_vars.ajax_url,cache:!1,dataType:"jsonp",crossDomain:!0,data:{action:"jck_woo_social_like_action",nonce:jck_woo_social_vars.nonce,product_id:s,type:i},success:function(o){if(c.length>0){var s=parseInt(c.text()),n="like"===i?s+1:s-1;c.text(n),a.attr("data-type",o.button.type),a.removeClass(e),a.removeClass("jck_woo_social-like-action--"+i),a.addClass("jck_woo_social-like-action--"+o.button.type),o.add_like_html&&t.find(".jck-woo-social-likes__item--like-button").after(o.add_like_html),o.remove_like_class&&t.find(o.remove_like_class).remove()}},error:function(o){}})),!1})},setup_tabs:function(){t.els.$tab_links.on("click",function(){var a=o(this).attr("href"),s="jck_woo_social-tab-link--active";return t.els.$tab_links.removeClass(s),o(this).addClass(s),t.els.$tab_content.hide(),o(a).show(),!1})},setup_load_more:function(){t.els.$load_more_button.on("click",function(){o(this).hasClass("jck_woo_social-load-more--activity")&&t.load_more_activity(o(this)),o(this).hasClass("jck_woo_social-load-more--likes")&&t.load_more_likes(o(this))})},load_more_activity:function(a){var t=parseInt(a.attr("data-limit")),s=parseInt(a.attr("data-offset")),i=t+s,c=a.attr("data-user-id"),e=a.attr("data-profile-user-id"),n=a.parent();o.ajax({type:"GET",url:jck_woo_social_vars.ajax_url,cache:!1,dataType:"jsonp",crossDomain:!0,data:{action:"jck_woo_social_load_more_activity",nonce:jck_woo_social_vars.nonce,limit:t,offset:s,user_id:c,profile_user_id:e},success:function(o){o.activity_html?(n.before(o.activity_html),a.attr("data-offset",i)):n.remove()},error:function(o){}})},load_more_likes:function(a){var s=parseInt(a.attr("data-limit")),i=parseInt(a.attr("data-offset")),c=s+i,e=a.attr("data-user-id");o.ajax({type:"GET",url:jck_woo_social_vars.ajax_url,cache:!1,dataType:"jsonp",crossDomain:!0,data:{action:"jck_woo_social_load_more_likes",nonce:jck_woo_social_vars.nonce,limit:s,offset:i,user_id:e},success:function(o){o.likes_html?(t.els.$likes_container.append(o.likes_html),a.attr("data-offset",c)):a.remove()},error:function(o){}})},setup_activity_log:function(){t.hide_actions(t.els.$action_blocks,t.vars.action_offset)},hide_actions:function(a,s){a.each(function(){o(this).offset().top>o(window).scrollTop()+o(window).height()*s&&o(this).find(".jck_woo_social-action__icon, .jck_woo_social-action__wrapper").css({opacity:0}).addClass(t.vars.is_hidden_class)})},show_actions:function(a,s){a.each(function(){o(this).offset().top<=o(window).scrollTop()+o(window).height()*s&&o(this).find(".jck_woo_social-action__icon").hasClass(t.vars.is_hidden_class)&&o(this).find(".jck_woo_social-action__icon, .jck_woo_social-action__wrapper").removeClass(t.vars.is_hidden_class).animate({opacity:1})})},scroll_activity_log:function(){window.requestAnimationFrame?window.requestAnimationFrame(function(){t.show_actions(t.els.$action_blocks,t.vars.action_offset)}):setTimeout(function(){t.show_actions(t.els.$action_blocks,t.vars.action_offset)},100)}};o(a).ready(t.on_ready()),o(window).on("scroll",function(){t.on_scroll()})}(jQuery,document);
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIm1haW4uanMiXSwibmFtZXMiOlsiJCIsImRvY3VtZW50IiwiamNrX3dvb19zb2NpYWwiLCJjYWNoZSIsImVscyIsInZhcnMiLCIkYWN0aW9uc19saXN0IiwiJHRhYl9saW5rcyIsIiR0YWJfY29udGVudCIsIiRsb2FkX21vcmVfYnV0dG9uIiwiJGFjdGlvbl9ibG9ja3MiLCIkbGlrZXNfY29udGFpbmVyIiwiYWN0aW9uX29mZnNldCIsImlzX2hpZGRlbl9jbGFzcyIsIm9uX3JlYWR5Iiwic2V0dXBfZm9sbG93X2FjdGlvbnMiLCJzZXR1cF9saWtlX2FjdGlvbiIsInNldHVwX3RhYnMiLCJzZXR1cF9sb2FkX21vcmUiLCJzZXR1cF9hY3Rpdml0eV9sb2ciLCJvbl9zY3JvbGwiLCJzY3JvbGxfYWN0aXZpdHlfbG9nIiwib24iLCIkYnV0dG9uIiwidGhpcyIsInVzZXJfaWQiLCJhdHRyIiwidHlwZSIsImxvYWRpbmdfY2xhc3MiLCJoYXNDbGFzcyIsImFkZENsYXNzIiwiYWpheCIsInVybCIsImpja193b29fc29jaWFsX3ZhcnMiLCJhamF4X3VybCIsImRhdGFUeXBlIiwiY3Jvc3NEb21haW4iLCJkYXRhIiwiYWN0aW9uIiwibm9uY2UiLCJzdWNjZXNzIiwidGV4dCIsImJ1dHRvbiIsInJlbW92ZUNsYXNzIiwiYWRkX2ZvbGxvd19odG1sIiwicHJlcGVuZCIsInJlbW92ZV9mb2xsb3dfY2xhc3MiLCJyZW1vdmUiLCJlcnJvciIsIiRjdXJyZW50X2xpa2VzX2xpc3QiLCJjbG9zZXN0IiwicHJvZHVjdF9pZCIsIiRjb3VudCIsImZpbmQiLCJsZW5ndGgiLCJjb3VudCIsInBhcnNlSW50IiwibmV3X2NvdW50IiwiYWRkX2xpa2VfaHRtbCIsImFmdGVyIiwicmVtb3ZlX2xpa2VfY2xhc3MiLCJ0YXJnZXQiLCJhY3RpdmVfY2xhc3MiLCJoaWRlIiwic2hvdyIsImxvYWRfbW9yZV9hY3Rpdml0eSIsImxvYWRfbW9yZV9saWtlcyIsImxpbWl0Iiwib2Zmc2V0IiwibmV4dF9vZmZzZXQiLCJwcm9maWxlX3VzZXJfaWQiLCIkbG9hZF9tb3JlX2l0ZW0iLCJwYXJlbnQiLCJhY3Rpdml0eV9odG1sIiwiYmVmb3JlIiwibGlrZXNfaHRtbCIsImFwcGVuZCIsImhpZGVfYWN0aW9ucyIsImVhY2giLCJ0b3AiLCJ3aW5kb3ciLCJzY3JvbGxUb3AiLCJoZWlnaHQiLCJjc3MiLCJvcGFjaXR5Iiwic2hvd19hY3Rpb25zIiwiYW5pbWF0ZSIsInJlcXVlc3RBbmltYXRpb25GcmFtZSIsInNldFRpbWVvdXQiLCJyZWFkeSIsImpRdWVyeSJdLCJtYXBwaW5ncyI6IkNBQUEsU0FBQUEsRUFBQUMsR0FFQSxHQUFBQyxJQUVBQyxNQUFBLFdBQ0FELEVBQUFFLE9BQ0FGLEVBQUFHLFFBRUFILEVBQUFFLElBQUFFLGNBQUFOLEVBQUEsMkJBQ0FFLEVBQUFFLElBQUFHLFdBQUFQLEVBQUEsNEJBQ0FFLEVBQUFFLElBQUFJLGFBQUFSLEVBQUEsK0JBQ0FFLEVBQUFFLElBQUFLLGtCQUFBVCxFQUFBLDZCQUNBRSxFQUFBRSxJQUFBTSxlQUFBVixFQUFBLDBCQUNBRSxFQUFBRSxJQUFBTyxpQkFBQVgsRUFBQSx5QkFFQUUsRUFBQUcsS0FBQU8sY0FBQSxFQUNBVixFQUFBRyxLQUFBUSxnQkFBQSw2QkFJQUMsU0FBQSxXQUVBWixFQUFBQyxRQUNBRCxFQUFBYSx1QkFDQWIsRUFBQWMsb0JBQ0FkLEVBQUFlLGFBQ0FmLEVBQUFnQixrQkFDQWhCLEVBQUFpQixzQkFJQUMsVUFBQSxXQUVBbEIsRUFBQW1CLHVCQUlBTixxQkFBQSxXQUVBZixFQUFBLGlDQUFBc0IsR0FBQSxRQUFBLFdBRUEsR0FBQUMsR0FBQXZCLEVBQUF3QixNQUNBQyxFQUFBRixFQUFBRyxLQUFBLGdCQUNBQyxFQUFBSixFQUFBRyxLQUFBLGFBQ0FFLEVBQUEsdUNBRUEsV0FBQUQsR0FJQUosRUFBQU0sU0FBQUQsS0FFQUwsRUFBQU8sU0FBQUYsR0FFQTVCLEVBQUErQixNQUNBSixLQUFBLE1BQ0FLLElBQUFDLG9CQUFBQyxTQUNBL0Is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QUFDLFlBQUFqRixFQUFBZ0YsUUFBQUUsU0FBQXRFLEdBQUFaLEVBQUF3QixNQUFBNkIsS0FBQSxnQ0FBQXhCLFNBQUEzQixFQUFBRyxLQUFBUSxrQkFDQWIsRUFBQXdCLE1BQUE2QixLQUFBLGlFQUNBVixZQUFBekMsRUFBQUcsS0FBQVEsaUJBQ0F5RSxTQUFBRixRQUFBLE9BT0EvRCxvQkFBQSxXQUVBMkQsT0FBQU8sc0JBTUFQLE9BQUFPLHNCQUFBLFdBQUFyRixFQUFBbUYsYUFBQW5GLEVBQUFFLElBQUFNLGVBQUFSLEVBQUFHLEtBQUFPLGlCQUpBNEUsV0FBQSxXQUFBdEYsRUFBQW1GLGFBQUFuRixFQUFBRSxJQUFBTSxlQUFBUixFQUFBRyxLQUFBTyxnQkFBQSxNQVlBWixHQUFBQyxHQUFBd0YsTUFBQXZGLEVBQUFZLFlBRUFkLEVBQUFnRixRQUFBMUQsR0FBQSxTQUFBLFdBQ0FwQixFQUFBa0IsZUFHQXNFLE9BQUF6RiIsImZpbGUiOiJtYWluLm1pbi5qcyIsInNvdXJjZXNDb250ZW50IjpbIihmdW5jdGlvbigkLCBkb2N1bWVudCkge1xuICAgIFxuICAgIHZhciBqY2tfd29vX3NvY2lhbCA9IHtcbiAgICAgICAgXG4gICAgICAgIGNhY2hlOiBmdW5jdGlvbigpIHtcbiAgICAgICAgICAgIGpja193b29fc29jaWFsLmVscyA9IHt9O1xuICAgICAgICAgICAgamNrX3dvb19zb2NpYWwudmFycyA9IHt9O1xuICAgICAgICAgICAgXG4gICAgICAgICAgICBqY2tfd29vX3NvY2lhbC5lbHMuJGFjdGlvbnNfbGlzdCA9ICQoJy5qY2tfd29vX3NvY2lhbC1hY3Rpb25zJyk7XG4gICAgICAgICAgICBqY2tfd29vX3NvY2lhbC5lbHMuJHRhYl9saW5rcyA9ICQoJy5qY2tfd29vX3NvY2lhbC10YWItbGluaycpO1xuICAgICAgICAgICAgamNrX3dvb19zb2NpYWwuZWxzLiR0YWJfY29udGVudCA9ICQoJy5qY2tfd29vX3NvY2lhbC10YWItY29udGVudCcpO1xuICAgICAgICAgICAgamNrX3dvb19zb2NpYWwuZWxzLiRsb2FkX21vcmVfYnV0dG9uID0gJCgnLmpja193b29fc29jaWFsLWxvYWQtbW9yZScpO1xuICAgICAgICAgICAgamNrX3dvb19zb2NpYWwuZWxzLiRhY3Rpb25fYmxvY2tzID0gJCgnLmpja193b29fc29jaWFsLWFjdGlvbicpOyAgICAgICAgICAgIFxuICAgICAgICAgICAgamNrX3dvb19zb2NpYWwuZWxzLiRsaWtlc19jb250YWluZXIgPSAkKCcuamNrX3dvb19zb2NpYWwtbGlrZXMnKTtcbiAgICAgICAgICAgIFxuICAgICAgICAgICAgamNrX3dvb19zb2NpYWwudmFycy5hY3Rpb25fb2Zmc2V0ID0gMTtcbiAgICAgICAgICAgIGpja193b29fc29jaWFsLnZhcnMuaXNfaGlkZGVuX2NsYXNzID0gXCJqY2tfd29vX3NvY2lhbC0taXMtaGlkZGVuXCI7XG4gICAgICAgICAgICBcbiAgICAgICAgfSxcbiBcbiAgICAgICAgb25fcmVhZHk6IGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgXG4gICAgICAgICAgICBqY2tfd29vX3NvY2lhbC5jYWNoZSgpO1xuICAgICAgICAgICAgamNrX3dvb19zb2NpYWwuc2V0dXBfZm9sbG93X2FjdGlvbnMoKTtcbiAgICAgICAgICAgIGpja193b29fc29jaWFsLnNldHVwX2xpa2VfYWN0aW9uKCk7XG4gICAgICAgICAgICBqY2tfd29vX3NvY2lhbC5zZXR1cF90YWJzKCk7XG4gICAgICAgICAgICBqY2tfd29vX3NvY2lhbC5zZXR1cF9sb2FkX21vcmUoKTtcbiAgICAgICAgICAgIGpja193b29fc29jaWFsLnNldHVwX2FjdGl2aXR5X2xvZygpO1xuICAgICAgICAgICAgXG4gICAgICAgIH0sXG4gICAgICAgIFxuICAgICAgICBvbl9zY3JvbGw6IGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgXG4gICAgICAgICAgICBqY2tfd29vX3NvY2lhbC5zY3JvbGxfYWN0aXZpdHlfbG9nKCk7XG4gICAgICAgICAgICBcbiAgICAgICAgfSxcbiAgICAgXG4gICAgICAgIHNldHVwX2ZvbGxvd19hY3Rpb25zOiBmdW5jdGlvbigpIHtcbiAgICAgICAgICAgIFxuICAgICAgICAgICAgJCgnLmpja193b29fc29jaWFsLWZvbGxvdy1hY3Rpb24nKS5vbignY2xpY2snLCBmdW5jdGlvbigpe1xuICAgICAgICAgICAgICAgIFxuICAgICAgICAgICAgICAgIHZhciAkYnV0dG9uID0gJCh0aGlzKSxcbiAgICAgICAgICAgICAgICAgICAgdXNlcl9pZCA9ICRidXR0b24uYXR0cignZGF0YS11c2VyLWlkJyksXG4gICAgICAgICAgICAgICAgICAgIHR5cGUgPSAkYnV0dG9uLmF0dHIoJ2RhdGEtdHlwZScpLFxuICAgICAgICAgICAgICAgICAgICBsb2FkaW5nX2NsYXNzID0gJ2pja193b29fc29jaWFsLWZvbGxvdy1hY3Rpb24tLWxvYWRpbmcnO1xuICAgICAgICAgICAgICAgIFxuICAgICAgICAgICAgICAgIGlmKCB0eXBlID09PSBcImxvZ2luXCIgKSB7XG4gICAgICAgICAgICAgICAgICAgIFxuICAgICAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgXG4gICAgICAgICAgICAgICAgICAgIGlmKCAhJGJ1dHRvbi5oYXNDbGFzcyhsb2FkaW5nX2NsYXNzKSApIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIFxuICAgICAgICAgICAgICAgICAgICAgICAgJGJ1dHRvbi5hZGRDbGFzcyhsb2FkaW5nX2NsYXNzKTtcbiAgICAgICAgICAgICAgICAgICAgXG4gICAgICAgICAgICAgICAgICAgICAgICAkLmFqYXgoe1xuICAgICAgICAgICAgXHRcdFx0XHR0eXBlOiBcIkdFVFwiLFxuICAgICAgICAgICAgXHRcdFx0XHR1cmw6IGpja193b29fc29jaWFsX3ZhcnMuYWpheF91cmwsXG4gICAgICAgICAgICBcdFx0XHRcdGNhY2hlOiBmYWxzZSxcbiAgICAgICAgICAgIFx0XHRcdFx0ZGF0YVR5cGU6IFwianNvbnBcIixcdFx0XHRcdFxuICAgICAgICAgICAgXHRcdFx0XHRjcm9zc0RvbWFpbjogdHJ1ZSxcbiAgICAgICAgICAgIFx0XHRcdFx0ZGF0YToge1xuICAgICAgICAgICAgXHRcdFx0XHRcdGFjdGlvbiA6ICdqY2tfd29vX3NvY2lhbF9mb2xsb3dfYWN0aW9uJyxcbiAgICAgICAgICAgIFx0XHRcdFx0XHRub25jZSA6IGpja193b29fc29jaWFsX3ZhcnMubm9uY2UsXG4gICAgICAgICAgICBcdFx0XHRcdFx0dXNlcl9pZCA6IHVzZXJfaWQsXG4gICAgICAgICAgICBcdFx0XHRcdFx0dHlwZSA6IHR5cGVcbiAgICAgICAgICAgIFx0XHRcdFx0fSxcbiAgICAgICAgICAgIFx0XHRcdFx0XG4gICAgICAgICAgICBcdFx0XHRcdHN1Y2Nlc3M6IGZ1bmN0aW9uKCBkYXRhICkge1xuICAgICAgICAgICAgXHRcdFx0XHRcdFxuICAgICAgICAgICAgXHRcdFx0XHRcdCRidXR0b24udGV4dChkYXRhLmJ1dHRvbi50ZXh0KTtcbiAgICAgICAgICAgIFx0XHRcdFx0XHQkYnV0dG9uLmF0dHIoJ2RhdGEtdHlwZScsZGF0YS5idXR0b24udHlwZSk7XG4gICAgICAgICAgICBcdFx0XHRcdFx0XG4gICAgICAgICAgICBcdFx0XHRcdFx0JGJ1dHRvbi5yZW1vdmVDbGFzcyhsb2FkaW5nX2NsYXNzKTtcbiAgICAgICAgICAgIFx0XHRcdFx0XHQkYnV0dG9uLnJlbW92ZUNsYXNzKCdqY2tfd29vX3NvY2lhbC1mb2xsb3ctYWN0aW9uLS0nK3R5cGUpO1xuICAgICAgICAgICAgXHRcdFx0XHRcdCRidXR0b24uYWRkQ2xhc3MoJ2pja193b29fc29jaWFsLWZvbGxvdy1hY3Rpb24tLScrZGF0YS5idXR0b24udHlwZSk7XG4gICAgICAgICAgICBcdFx0XHRcdFx0XG4gICAgICAgICAgICBcdFx0XHRcdFx0aWYoZGF0YS5hZGRfZm9sbG93X2h0bWwpIHtcbiAgICAgICAgICAgICAgICBcdFx0XHRcdFx0amNrX3dvb19zb2NpYWwuZWxzLiRhY3Rpb25zX2xpc3QucHJlcGVuZChkYXRhLmFkZF9mb2xsb3dfaHRtbCk7XG4gICAgICAgICAgICBcdFx0XHRcdFx0fVxuICAgICAgICAgICAgXHRcdFx0XHRcdFxuICAgICAgICAgICAgXHRcdFx0XHRcdGlmKGRhdGEucmVtb3ZlX2ZvbGxvd19jbGFzcykge1xuICAgICAgICAgICAgICAgIFx0XHRcdFx0XHQkKGRhdGEucmVtb3ZlX2ZvbGxvd19jbGFzcykucmVtb3ZlKCk7XG4gICAgICAgICAgICBcdFx0XHRcdFx0fVxuICAgICAgICAgICAgXHRcdFx0XHR9LFxuICAgICAgICAgICAgXHRcdFx0XHRcbiAgICAgICAgICAgIFx0XHRcdFx0ZXJyb3I6IGZ1bmN0aW9uKCBkYXRhICkge1xuICAgICAgICAgICAgICAgIFx0XHRcdFx0XG4gICAgICAgICAgICBcdFx0XHRcdH1cbiAgICAgICAgICAgIFx0XHRcdH0pO1xuICAgICAgICBcdFx0XHRcbiAgICAgICAgXHRcdFx0fVxuICAgIFx0XHRcdFxuICAgIFx0XHRcdH1cblx0XHRcdFxuXHRcdFx0fSk7XG4gICAgICAgICAgICBcbiAgICAgICAgfSxcbiAgICAgICAgXG4gICAgICAgIHNldHVwX2xpa2VfYWN0aW9uOiBmdW5jdGlvbigpIHtcbiAgICAgICAgICAgIFxuICAgICAgICAgICAgJChkb2N1bWVudCkub24oJ2NsaWNrJywgJy5qY2std29vLXNvY2lhbC1saWtlLWFjdGlvbicsIGZ1bmN0aW9uKCl7XG4gICAgICAgICAgICAgICAgXG4gICAgICAgICAgICAgICAgdmFyICRidXR0b24gPSAkKHRoaXMpLFxuICAgICAgICAgICAgICAgICAgICAkY3VycmVudF9saWtlc19saXN0ID0gJGJ1dHRvbi5jbG9zZXN0KCcuamNrLXdvby1zb2NpYWwtbGlrZXMnKSxcbiAgICAgICAgICAgICAgICAgICAgcHJvZHVjdF9pZCA9ICRidXR0b24uYXR0cignZGF0YS1wcm9kdWN0LWlkJyksXG4gICAgICAgICAgICAgICAgICAgIHR5cGUgPSAkYnV0dG9uLmF0dHIoJ2RhdGEtdHlwZScpLFxuICAgICAgICAgICAgICAgICAgICAkY291bnQgPSAkYnV0dG9uLmZpbmQoJy5qY2std29vLXNvY2lhbC1saWtlLWJ1dHRvbl9fY291bnQnKSxcbiAgICAgICAgICAgICAgICAgICAgbG9hZGluZ19jbGFzcyA9ICdqY2tfd29vX3NvY2lhbC1mb2xsb3ctYWN0aW9uLS1sb2FkaW5nJztcbiAgICAgICAgICAgICAgICAgICAgXG4gICAgICAgICAgICAgICAgaWYoICEkYnV0dG9uLmhhc0NsYXNzKGxvYWRpbmdfY2xhc3MpICkge1xuICAgICAgICAgICAgICAgICAgICAgICAgXG4gICAgICAgICAgICAgICAgICAgICRidXR0b24uYWRkQ2xhc3MobG9hZGluZ19jbGFzcyk7XG4gICAgICAgICAgICAgICAgICAgIFxuICAgICAgICAgICAgICAgICAgICAkLmFqYXgoe1xuICAgICAgICBcdFx0XHRcdHR5cGU6IFwiR0VUXCIsXG4gICAgICAgIFx0XHRcdFx0dXJsOiBqY2tfd29vX3NvY2lhbF92YXJzLmFqYXhfdXJsLFxuICAgICAgICBcdFx0XHRcdGNhY2hlOiBmYWxzZSxcbiAgICAgICAgXHRcdFx0XHRkYXRhVHlwZTogXCJqc29ucFwiLFx0XHRcdFx0XG4gICAgICAgIFx0XHRcdFx0Y3Jvc3NEb21haW46IHRydWUsXG4gICAgICAgIFx0XHRcdFx0ZGF0YToge1xuICAgICAgICBcdFx0XHRcdFx0YWN0aW9uIDogJ2pja193b29fc29jaWFsX2xpa2VfYWN0aW9uJyxcbiAgICAgICAgXHRcdFx0XHRcdG5vbmNlIDogamNrX3dvb19zb2NpYWxfdmFycy5ub25jZSxcbiAgICAgICAgXHRcdFx0XHRcdHByb2R1Y3RfaWQgOiBwcm9kdWN0X2lkLFxuICAgICAgICBcdFx0XHRcdFx0dHlwZSA6IHR5cGVcbiAgICAgICAgXHRcdFx0XHR9LFxuICAgICAgICBcdFx0XHRcdFxuICAgICAgICBcdFx0XHRcdHN1Y2Nlc3M6IGZ1bmN0aW9uKCBkYXRhICkge1xuICAgICAgICBcdFx0XHRcdFx0XG4gICAgICAgIFx0XHRcdFx0XHRpZiggJGNvdW50Lmxlbmd0aCA+IDAgKSB7XG4gICAgICAgICAgICBcdFx0XHRcdFx0XG4gICAgICAgICAgICBcdFx0XHRcdFx0dmFyIGNvdW50ID0gcGFyc2VJbnQoJGNvdW50LnRleHQoKSksXG4gICAgICAgICAgICBcdFx0XHRcdFx0ICAgIG5ld19jb3VudCA9IHR5cGUgPT09IFwibGlrZVwiID8gY291bnQrMSA6IGNvdW50LTE7XG4gICAgICAgICAgICBcdFx0XHRcdFx0XG4gICAgICAgICAgICBcdFx0XHRcdFx0JGNvdW50LnRleHQoIG5ld19jb3VudCApOyBcbiAgICAgICAgICAgIFx0XHRcdFx0XHQkYnV0dG9uLmF0dHIoJ2RhdGEtdHlwZScsIGRhdGEuYnV0dG9uLnR5cGUpO1xuICAgICAgICAgICAgXHRcdFx0XHRcdFxuICAgICAgICAgICAgXHRcdFx0XHRcdCRidXR0b24ucmVtb3ZlQ2xhc3MobG9hZGluZ19jbGFzcyk7XG4gICAgICAgICAgICBcdFx0XHRcdFx0JGJ1dHRvbi5yZW1vdmVDbGFzcygnamNrX3dvb19zb2NpYWwtbGlrZS1hY3Rpb24tLScrdHlwZSk7XG4gICAgICAgICAgICBcdFx0XHRcdFx0JGJ1dHRvbi5hZGRDbGFzcygnamNrX3dvb19zb2NpYWwtbGlrZS1hY3Rpb24tLScrZGF0YS5idXR0b24udHlwZSk7XG4gICAgICAgICAgICBcdFx0XHRcdFx0XG4gICAgICAgICAgICBcdFx0XHRcdFx0aWYoZGF0YS5hZGRfbGlrZV9odG1sKSB7XG4gICAgICAgICAgICAgICAgXHRcdFx0XHRcdCRjdXJyZW50X2xpa2VzX2xpc3QuZmluZCgnLmpjay13b28tc29jaWFsLWxpa2VzX19pdGVtLS1saWtlLWJ1dHRvbicpLmFmdGVyKGRhdGEuYWRkX2xpa2VfaHRtbCk7XG4gICAgICAgICAgICBcdFx0XHRcdFx0fVxuICAgICAgICAgICAgXHRcdFx0XHRcdFxuICAgICAgICAgICAgXHRcdFx0XHRcdGlmKGRhdGEucmVtb3ZlX2xpa2VfY2xhc3MpIHtcbiAgICAgICAgICAgICAgICBcdFx0XHRcdFx0JGN1cnJlbnRfbGlrZXNfbGlzdC5maW5kKGRhdGEucmVtb3ZlX2xpa2VfY2xhc3MpLnJlbW92ZSgpO1xuICAgICAgICAgICAgXHRcdFx0XHRcdH0gICAgIFx0XHRcdFx0XHRcbiAgICAgICAgICAgIFx0XHRcdFx0XHRcbiAgICAgICAgXHRcdFx0XHRcdH1cbiAgICAgICAgXHRcdFx0XHR9LFxuICAgICAgICBcdFx0XHRcdFxuICAgICAgICBcdFx0XHRcdGVycm9yOiBmdW5jdGlvbiggZGF0YSApIHtcbiAgICAgICAgICAgIFx0XHRcdFx0XG4gICAgICAgIFx0XHRcdFx0fVxuICAgICAgICBcdFx0XHR9KTtcbiAgICAgICAgXG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIFxuICAgICAgICAgICAgICAgIHJldHVybiBmYWxzZTtcbiAgICAgICAgICAgICAgICBcbiAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgXG4gICAgICAgIH0sXG4gICAgICAgIFxuICAgICAgICBzZXR1cF90YWJzOiBmdW5jdGlvbigpIHtcbiAgICAgICAgICAgIFxuICAgICAgICAgICAgamNrX3dvb19zb2NpYWwuZWxzLiR0YWJfbGlua3Mub24oJ2NsaWNrJywgZnVuY3Rpb24oKXtcbiAgICAgICAgICAgICAgICBcbiAgICAgICAgICAgICAgICB2YXIgdGFyZ2V0ID0gJCh0aGlzKS5hdHRyKCdocmVmJyksXG4gICAgICAgICAgICAgICAgICAgIGFjdGl2ZV9jbGFzcyA9ICdqY2tfd29vX3NvY2lhbC10YWItbGluay0tYWN0aXZlJztcbiAgICAgICAgICAgICAgICBcbiAgICAgICAgICAgICAgICBqY2tfd29vX3NvY2lhbC5lbHMuJHRhYl9saW5rcy5yZW1vdmVDbGFzcyhhY3RpdmVfY2xhc3MpO1xuICAgICAgICAgICAgICAgICQodGhpcykuYWRkQ2xhc3MoYWN0aXZlX2NsYXNzKTtcbiAgICAgICAgICAgICAgICBqY2tfd29vX3NvY2lhbC5lbHMuJHRhYl9jb250ZW50LmhpZGUoKTtcbiAgICAgICAgICAgICAgICAkKHRhcmdldCkuc2hvdygpO1xuICAgICAgICAgICAgICAgIFxuICAgICAgICAgICAgICAgIHJldHVybiBmYWxzZTtcbiAgICAgICAgICAgICAgICBcbiAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgXG4gICAgICAgIH0sXG4gICAgICAgIFxuICAgICAgICBzZXR1cF9sb2FkX21vcmU6IGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgXG4gICAgICAgICAgICBqY2tfd29vX3NvY2lhbC5lbHMuJGxvYWRfbW9yZV9idXR0b24ub24oJ2NsaWNrJywgZnVuY3Rpb24oKXtcbiAgICAgICAgICAgICAgIFxuICAgICAgICAgICAgICAgIGlmKCAkKHRoaXMpLmhhc0NsYXNzKCdqY2tfd29vX3NvY2lhbC1sb2FkLW1vcmUtLWFjdGl2aXR5JykgKSB7XG4gICAgICAgICAgICAgICAgICAgIGpja193b29fc29jaWFsLmxvYWRfbW9yZV9hY3Rpdml0eSggJCh0aGlzKSApO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgXG4gICAgICAgICAgICAgICAgaWYoICQodGhpcykuaGFzQ2xhc3MoJ2pja193b29fc29jaWFsLWxvYWQtbW9yZS0tbGlrZXMnKSApIHtcbiAgICAgICAgICAgICAgICAgICAgamNrX3dvb19zb2NpYWwubG9hZF9tb3JlX2xpa2VzKCAkKHRoaXMpICk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIFxuICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICBcbiAgICAgICAgfSxcbiAgICAgICAgXG4gICAgICAgIGxvYWRfbW9yZV9hY3Rpdml0eTogZnVuY3Rpb24oICRsb2FkX21vcmVfYnV0dG9uICkge1xuICAgICAgICAgICAgXG4gICAgICAgICAgICB2YXIgbGltaXQgPSBwYXJzZUludCggJGxvYWRfbW9yZV9idXR0b24uYXR0cignZGF0YS1saW1pdCcpICksXG4gICAgICAgICAgICAgICAgb2Zmc2V0ID0gcGFyc2VJbnQoICRsb2FkX21vcmVfYnV0dG9uLmF0dHIoJ2RhdGEtb2Zmc2V0JykgKSxcbiAgICAgICAgICAgICAgICBuZXh0X29mZnNldCA9IGxpbWl0K29mZnNldCxcbiAgICAgICAgICAgICAgICB1c2VyX2lkID0gJGxvYWRfbW9yZV9idXR0b24uYXR0cignZGF0YS11c2VyLWlkJyksXG4gICAgICAgICAgICAgICAgcHJvZmlsZV91c2VyX2lkID0gJGxvYWRfbW9yZV9idXR0b24uYXR0cignZGF0YS1wcm9maWxlLXVzZXItaWQnKSxcbiAgICAgICAgICAgICAgICAkbG9hZF9tb3JlX2l0ZW0gPSAkbG9hZF9tb3JlX2J1dHRvbi5wYXJlbnQoKTtcbiAgICAgICAgICAgICAgICBcbiAgICAgICAgICAgICQuYWpheCh7XG5cdFx0XHRcdHR5cGU6IFwiR0VUXCIsXG5cdFx0XHRcdHVybDogamNrX3dvb19zb2NpYWxfdmFycy5hamF4X3VybCxcblx0XHRcdFx0Y2FjaGU6IGZhbHNlLFxuXHRcdFx0XHRkYXRhVHlwZTogXCJqc29ucFwiLFx0XHRcdFx0XG5cdFx0XHRcdGNyb3NzRG9tYWluOiB0cnVlLFxuXHRcdFx0XHRkYXRhOiB7XG5cdFx0XHRcdFx0YWN0aW9uIDogJ2pja193b29fc29jaWFsX2xvYWRfbW9yZV9hY3Rpdml0eScsXG5cdFx0XHRcdFx0bm9uY2UgOiBqY2tfd29vX3NvY2lhbF92YXJzLm5vbmNlLFxuXHRcdFx0XHRcdGxpbWl0IDogbGltaXQsXG5cdFx0XHRcdFx0b2Zmc2V0IDogb2Zmc2V0LFxuXHRcdFx0XHRcdHVzZXJfaWQgOiB1c2VyX2lkLFxuXHRcdFx0XHRcdHByb2ZpbGVfdXNlcl9pZCA6IHByb2ZpbGVfdXNlcl9pZFxuXHRcdFx0XHR9LFxuXHRcdFx0XHRcblx0XHRcdFx0c3VjY2VzczogZnVuY3Rpb24oIGRhdGEgKSB7XG5cdFx0XHRcdFx0XG5cdFx0XHRcdFx0aWYoIGRhdGEuYWN0aXZpdHlfaHRtbCApIHtcbiAgICBcdFx0XHRcdFx0XG4gICAgXHRcdFx0XHRcdCRsb2FkX21vcmVfaXRlbS5iZWZvcmUoIGRhdGEuYWN0aXZpdHlfaHRtbCApO1xuICAgIFx0XHRcdFx0XHQkbG9hZF9tb3JlX2J1dHRvbi5hdHRyKCdkYXRhLW9mZnNldCcsIG5leHRfb2Zmc2V0KSA7XG4gICAgXHRcdFx0XHRcdFxuXHRcdFx0XHRcdH0gZWxzZSB7XG4gICAgXHRcdFx0XHRcdFxuICAgIFx0XHRcdFx0XHQkbG9hZF9tb3JlX2l0ZW0ucmVtb3ZlKCk7XG4gICAgXHRcdFx0XHRcdFxuXHRcdFx0XHRcdH1cblx0XHRcdFx0XHRcblx0XHRcdFx0fSxcblx0XHRcdFx0XG5cdFx0XHRcdGVycm9yOiBmdW5jdGlvbiggZGF0YSApIHtcbiAgICBcdFx0XHRcdFxuXHRcdFx0XHR9XG5cdFx0XHR9KTtcbiAgICAgICAgICAgIFxuICAgICAgICB9LFxuICAgICAgICBcbiAgICAgICAgbG9hZF9tb3JlX2xpa2VzOiBmdW5jdGlvbiggJGxvYWRfbW9yZV9idXR0b24gKSB7XG4gICAgICAgICAgICBcbiAgICAgICAgICAgIHZhciBsaW1pdCA9IHBhcnNlSW50KCAkbG9hZF9tb3JlX2J1dHRvbi5hdHRyKCdkYXRhLWxpbWl0JykgKSxcbiAgICAgICAgICAgICAgICBvZmZzZXQgPSBwYXJzZUludCggJGxvYWRfbW9yZV9idXR0b24uYXR0cignZGF0YS1vZmZzZXQnKSApLFxuICAgICAgICAgICAgICAgIG5leHRfb2Zmc2V0ID0gbGltaXQrb2Zmc2V0LFxuICAgICAgICAgICAgICAgIHVzZXJfaWQgPSAkbG9hZF9tb3JlX2J1dHRvbi5hdHRyKCdkYXRhLXVzZXItaWQnKTtcbiAgICAgICAgICAgICAgICBcbiAgICAgICAgICAgICQuYWpheCh7XG5cdFx0XHRcdHR5cGU6IFwiR0VUXCIsXG5cdFx0XHRcdHVybDogamNrX3dvb19zb2NpYWxfdmFycy5hamF4X3VybCxcblx0XHRcdFx0Y2FjaGU6IGZhbHNlLFxuXHRcdFx0XHRkYXRhVHlwZTogXCJqc29ucFwiLFx0XHRcdFx0XG5cdFx0XHRcdGNyb3NzRG9tYWluOiB0cnVlLFxuXHRcdFx0XHRkYXRhOiB7XG5cdFx0XHRcdFx0YWN0aW9uIDogJ2pja193b29fc29jaWFsX2xvYWRfbW9yZV9saWtlcycsXG5cdFx0XHRcdFx0bm9uY2UgOiBqY2tfd29vX3NvY2lhbF92YXJzLm5vbmNlLFxuXHRcdFx0XHRcdGxpbWl0IDogbGltaXQsXG5cdFx0XHRcdFx0b2Zmc2V0IDogb2Zmc2V0LFxuXHRcdFx0XHRcdHVzZXJfaWQgOiB1c2VyX2lkXG5cdFx0XHRcdH0sXG5cdFx0XHRcdFxuXHRcdFx0XHRzdWNjZXNzOiBmdW5jdGlvbiggZGF0YSApIHtcblx0XHRcdFx0XHRcblx0XHRcdFx0XHRpZiggZGF0YS5saWtlc19odG1sICkge1xuICAgIFx0XHRcdFx0XHRcbiAgICBcdFx0XHRcdFx0amNrX3dvb19zb2NpYWwuZWxzLiRsaWtlc19jb250YWluZXIuYXBwZW5kKCBkYXRhLmxpa2VzX2h0bWwgKTtcbiAgICBcdFx0XHRcdFx0JGxvYWRfbW9yZV9idXR0b24uYXR0cignZGF0YS1vZmZzZXQnLCBuZXh0X29mZnNldCkgO1xuICAgIFx0XHRcdFx0XHRcblx0XHRcdFx0XHR9IGVsc2Uge1xuICAgIFx0XHRcdFx0XHRcbiAgICBcdFx0XHRcdFx0JGxvYWRfbW9yZV9idXR0b24ucmVtb3ZlKCk7XG4gICAgXHRcdFx0XHRcdFxuXHRcdFx0XHRcdH1cblx0XHRcdFx0XHRcblx0XHRcdFx0fSxcblx0XHRcdFx0XG5cdFx0XHRcdGVycm9yOiBmdW5jdGlvbiggZGF0YSApIHtcbiAgICBcdFx0XHRcdFxuXHRcdFx0XHR9XG5cdFx0XHR9KTtcbiAgICAgICAgICAgIFxuICAgICAgICB9LFxuICAgICAgICBcbiAgICAgICAgc2V0dXBfYWN0aXZpdHlfbG9nOiBmdW5jdGlvbigpIHtcbiAgICAgICAgICAgIFxuICAgICAgICAgICAgamNrX3dvb19zb2NpYWwuaGlkZV9hY3Rpb25zKGpja193b29fc29jaWFsLmVscy4kYWN0aW9uX2Jsb2NrcywgamNrX3dvb19zb2NpYWwudmFycy5hY3Rpb25fb2Zmc2V0KTtcbiAgICAgICAgICAgIFxuICAgICAgICB9LFxuICAgICAgICBcbiAgICAgICAgaGlkZV9hY3Rpb25zOiBmdW5jdGlvbigkYWN0aW9uX2Jsb2NrcywgYWN0aW9uX29mZnNldCkge1xuICAgIFx0XHRcbiAgICBcdFx0JGFjdGlvbl9ibG9ja3MuZWFjaChmdW5jdGlvbigpe1xuICAgIFx0XHRcdFxuICAgIFx0XHRcdGlmKCAkKHRoaXMpLm9mZnNldCgpLnRvcCA+ICQod2luZG93KS5zY3JvbGxUb3AoKSskKHdpbmRvdykuaGVpZ2h0KCkqYWN0aW9uX29mZnNldCApIHtcbiAgICAgICAgXHRcdFx0JCh0aGlzKS5maW5kKCcuamNrX3dvb19zb2NpYWwtYWN0aW9uX19pY29uLCAuamNrX3dvb19zb2NpYWwtYWN0aW9uX193cmFwcGVyJykuY3NzKHsgb3BhY2l0eTogMCB9KS5hZGRDbGFzcyhqY2tfd29vX3NvY2lhbC52YXJzLmlzX2hpZGRlbl9jbGFzcyk7XG4gICAgICAgICAgICAgICAgfVxuICAgIFx0XHRcdFxuICAgIFx0XHR9KTtcbiAgICBcdFx0XG4gICAgXHR9LFxuICAgIFxuICAgIFx0c2hvd19hY3Rpb25zOiBmdW5jdGlvbigkYWN0aW9uX2Jsb2NrcywgYWN0aW9uX29mZnNldCkge1xuICAgIFx0XHRcbiAgICBcdFx0JGFjdGlvbl9ibG9ja3MuZWFjaChmdW5jdGlvbigpe1xuICAgIFx0XHRcdFxuICAgIFx0XHRcdGlmKCAkKHRoaXMpLm9mZnNldCgpLnRvcCA8PSAkKHdpbmRvdykuc2Nyb2xsVG9wKCkrJCh3aW5kb3cpLmhlaWdodCgpKmFjdGlvbl9vZmZzZXQgJiYgJCh0aGlzKS5maW5kKCcuamNrX3dvb19zb2NpYWwtYWN0aW9uX19pY29uJykuaGFzQ2xhc3MoamNrX3dvb19zb2NpYWwudmFycy5pc19oaWRkZW5fY2xhc3MpICkge1xuICAgICAgICBcdFx0XHQkKHRoaXMpLmZpbmQoJy5qY2tfd29vX3NvY2lhbC1hY3Rpb25fX2ljb24sIC5qY2tfd29vX3NvY2lhbC1hY3Rpb25fX3dyYXBwZXInKVxuICAgICAgICBcdFx0XHQgICAgLnJlbW92ZUNsYXNzKGpja193b29fc29jaWFsLnZhcnMuaXNfaGlkZGVuX2NsYXNzKVxuICAgICAgICBcdFx0XHQgICAgLmFuaW1hdGUoeyBvcGFjaXR5OiAxIH0pO1xuICAgICAgICAgICAgICAgIH1cbiAgICBcdFx0XHRcbiAgICBcdFx0fSk7XG4gICAgXHRcdFxuICAgIFx0fSxcbiAgICBcdFxuICAgIFx0c2Nyb2xsX2FjdGl2aXR5X2xvZzogZnVuY3Rpb24oKSB7XG4gICAgICAgIFx0XG4gICAgICAgIFx0aWYoIXdpbmRvdy5yZXF1ZXN0QW5pbWF0aW9uRnJhbWUpIHtcbiAgICAgICAgICAgIFx0XG5cdFx0XHQgICAgc2V0VGltZW91dChmdW5jdGlvbigpeyBqY2tfd29vX3NvY2lhbC5zaG93X2FjdGlvbnMoamNrX3dvb19zb2NpYWwuZWxzLiRhY3Rpb25fYmxvY2tzLCBqY2tfd29vX3NvY2lhbC52YXJzLmFjdGlvbl9vZmZzZXQpOyB9LCAxMDApO1xuICAgICAgICAgICBcbiAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgXG4gICAgICAgICAgICAgICAgd2luZG93LnJlcXVlc3RBbmltYXRpb25GcmFtZShmdW5jdGlvbigpeyBqY2tfd29vX3NvY2lhbC5zaG93X2FjdGlvbnMoamNrX3dvb19zb2NpYWwuZWxzLiRhY3Rpb25fYmxvY2tzLCBqY2tfd29vX3NvY2lhbC52YXJzLmFjdGlvbl9vZmZzZXQpOyB9KTsgIFxuICAgICAgICAgICAgICAgIFxuICAgICAgICAgICAgfVxuICAgICAgICAgICAgXG4gICAgXHR9XG4gICAgIFxuICAgIH07XG4gICAgXG5cdCQoZG9jdW1lbnQpLnJlYWR5KCBqY2tfd29vX3NvY2lhbC5vbl9yZWFkeSgpICk7XG5cdFxuXHQkKHdpbmRvdykub24oJ3Njcm9sbCcsIGZ1bmN0aW9uKCl7XG4gICAgXHRqY2tfd29vX3NvY2lhbC5vbl9zY3JvbGwoKTtcbiAgICB9KTtcblxufShqUXVlcnksIGRvY3VtZW50KSk7Il0sInNvdXJjZVJvb3QiOiIvc291cmNlLyJ9